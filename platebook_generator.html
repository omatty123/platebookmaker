<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HIST 213 Platebook Generator</title>
    <style>
        /* ============================================
           SCREEN-ONLY STYLES (Configuration UI)
           ============================================ */
        @media screen {
            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
                margin: 0;
                padding: 0;
                background: #f5f5f7;
            }

            .config-panel {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                padding: 2rem;
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            }

            .config-panel h1 {
                margin: 0 0 0.5rem 0;
                font-size: 2rem;
            }

            .config-panel p {
                margin: 0 0 1.5rem 0;
                opacity: 0.9;
            }

            .input-group {
                background: rgba(255, 255, 255, 0.2);
                backdrop-filter: blur(10px);
                border-radius: 12px;
                padding: 1.5rem;
                margin-bottom: 1rem;
            }

            .input-group label {
                display: block;
                font-weight: 600;
                margin-bottom: 0.5rem;
                font-size: 0.9rem;
                text-transform: uppercase;
                letter-spacing: 0.05em;
            }

            .input-group input {
                width: 100%;
                padding: 0.75rem;
                border: 2px solid rgba(255, 255, 255, 0.3);
                border-radius: 8px;
                font-size: 1rem;
                background: rgba(255, 255, 255, 0.9);
                box-sizing: border-box;
            }

            .button-group {
                display: flex;
                gap: 1rem;
            }

            button {
                flex: 1;
                padding: 1rem 2rem;
                border: none;
                border-radius: 8px;
                font-size: 1rem;
                font-weight: 600;
                cursor: pointer;
                transition: transform 0.2s;
            }

            button:hover {
                transform: translateY(-2px);
            }

            #generateBtn {
                background: white;
                color: #667eea;
            }

            #printBtn {
                background: #2ecc71;
                color: white;
            }

            #printBtn:disabled {
                background: #95a5a6;
                cursor: not-allowed;
            }

            .status {
                margin-top: 1rem;
                padding: 1rem;
                border-radius: 8px;
                background: rgba(255, 255, 255, 0.2);
                display: none;
            }

            .status.show {
                display: block;
            }

            .status.error {
                background: rgba(231, 76, 60, 0.3);
            }

            .status.success {
                background: rgba(46, 204, 113, 0.3);
            }
        }

        /* ============================================
           PRINT STYLES (Platebook Layout)
           ============================================ */
        @page {
            size: letter;
            margin: 0.5in;
        }

        @media print {
            .config-panel {
                display: none !important;
            }

            body {
                margin: 0;
                padding: 0;
            }
        }

        /* Cover Page */
        .cover-page {
            width: 100%;
            height: 10in;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-end;
            page-break-after: always;
            padding-bottom: 2in;
            box-sizing: border-box;
        }

        .cover-page h1 {
            font-size: 18pt;
            font-weight: bold;
            margin: 0 0 0.5rem 0;
            text-align: center;
        }

        .cover-page h2 {
            font-size: 16pt;
            font-weight: bold;
            margin: 0 0 2rem 0;
        }

        .cover-page input {
            border: 2px solid black;
            padding: 0.5rem 1rem;
            font-size: 12pt;
            width: 400px;
            text-align: center;
        }

        /* Table of Contents */
        .toc-page {
            page-break-after: always;
            padding: 1rem 0;
        }

        .toc-page h2 {
            font-size: 16pt;
            font-weight: bold;
            text-align: center;
            margin: 0 0 0.5rem 0;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid black;
        }

        .toc-entry {
            display: grid;
            grid-template-columns: 80px 1fr 100px;
            padding: 0.5rem 0;
            border-bottom: 1px dotted #ccc;
            font-size: 10pt;
        }

        .toc-plate {
            font-weight: bold;
        }

        .toc-date {
            text-align: right;
            font-style: italic;
        }

        /* Plate Layout */
        .plate {
            page-break-after: always;
            page-break-inside: avoid;
            position: relative;
        }

        .plate-box {
            border: 2px solid black;
            border-radius: 5px;
            padding: 0.5rem;
            box-sizing: border-box;
            position: absolute;
        }

        .plate-box.filled {
            background: #eeeeee;
        }

        .plate-label {
            font-weight: bold;
            font-size: 10pt;
            text-align: center;
        }

        /* Header boxes */
        .plate-num {
            left: 36pt;
            top: 29pt;
            width: 85pt;
            height: 28pt;
            font-size: 12pt;
        }

        .plate-title {
            left: 125pt;
            top: 29pt;
            width: 280pt;
            height: 28pt;
            font-size: 11pt;
        }

        .plate-date {
            left: 465pt;
            top: 29pt;
            width: 111pt;
            height: 28pt;
            font-size: 12pt;
        }

        /* PPT Labels */
        .label-person {
            left: 36pt;
            top: 68pt;
            width: 65pt;
            height: 24pt;
        }

        .label-place {
            left: 216pt;
            top: 68pt;
            width: 55pt;
            height: 24pt;
        }

        .label-thing {
            left: 396pt;
            top: 68pt;
            width: 60pt;
            height: 24pt;
        }

        /* PPT Content Boxes (3x3 grid) */
        .ppt-box {
            width: 180pt;
            height: 20pt;
        }

        .ppt-0-0 {
            left: 36pt;
            top: 92pt;
        }

        .ppt-0-1 {
            left: 216pt;
            top: 92pt;
        }

        .ppt-0-2 {
            left: 396pt;
            top: 92pt;
        }

        .ppt-1-0 {
            left: 36pt;
            top: 112pt;
        }

        .ppt-1-1 {
            left: 216pt;
            top: 112pt;
        }

        .ppt-1-2 {
            left: 396pt;
            top: 112pt;
        }

        .ppt-2-0 {
            left: 36pt;
            top: 132pt;
        }

        .ppt-2-1 {
            left: 216pt;
            top: 132pt;
        }

        .ppt-2-2 {
            left: 396pt;
            top: 132pt;
        }

        /* Timeline */
        .label-timeline {
            left: 36pt;
            top: 158pt;
            width: 70pt;
            height: 24pt;
        }

        .box-timeline {
            left: 36pt;
            top: 182pt;
            width: 540pt;
            height: 60pt;
        }

        .timeline-line {
            position: absolute;
            left: 50pt;
            top: 212pt;
            width: 512pt;
            height: 2px;
            background: black;
        }

        .timeline-tick {
            position: absolute;
            width: 2px;
            height: 16px;
            background: black;
            top: 204pt;
        }

        /* Map */
        .label-map {
            left: 36pt;
            top: 248pt;
            width: 45pt;
            height: 24pt;
        }

        .box-map {
            left: 36pt;
            top: 272pt;
            width: 540pt;
            height: 200pt;
        }

        /* Questions */
        .label-pq {
            left: 36pt;
            top: 483pt;
            width: 165pt;
            height: 24pt;
            font-size: 9pt;
        }

        .label-vsa {
            left: 410pt;
            top: 483pt;
            width: 166pt;
            height: 24pt;
            font-size: 9pt;
        }

        .q-num-1 {
            left: 36pt;
            top: 507pt;
            width: 30pt;
            height: 50pt;
        }

        .q-content-1 {
            left: 66pt;
            top: 507pt;
            width: 330pt;
            height: 50pt;
        }

        .q-answer-1 {
            left: 396pt;
            top: 507pt;
            width: 180pt;
            height: 50pt;
        }

        .q-num-2 {
            left: 36pt;
            top: 567pt;
            width: 30pt;
            height: 50pt;
        }

        .q-content-2 {
            left: 66pt;
            top: 567pt;
            width: 330pt;
            height: 50pt;
        }

        .q-answer-2 {
            left: 396pt;
            top: 567pt;
            width: 180pt;
            height: 50pt;
        }

        /* Bottom */
        .label-cec {
            left: 36pt;
            top: 622pt;
            width: 185pt;
            height: 20pt;
            font-size: 8pt;
        }

        .label-notes {
            left: 312pt;
            top: 622pt;
            width: 55pt;
            height: 20pt;
        }

        .box-cec {
            left: 36pt;
            top: 642pt;
            width: 264pt;
            height: 88pt;
        }

        .box-notes {
            left: 312pt;
            top: 642pt;
            width: 264pt;
            height: 88pt;
        }
    </style>
</head>

<body>
    <!-- Configuration Panel (Screen Only) -->
    <div class="config-panel">
        <h1>üìö Platebook Generator</h1>
        <p>Generate print-ready platebooks from Google Sheets</p>

        <div class="input-group">
            <label>Course Name</label>
            <input type="text" id="courseName" value="HIST 213 East Asia in the Modern World">
        </div>

        <div class="input-group">
            <label>Term</label>
            <input type="text" id="termName" value="Winter 2026">
        </div>

        <div class="input-group">
            <label>Google Sheet CSV URL (Published)</label>
            <input type="text" id="sheetUrl" placeholder="https://docs.google.com/spreadsheets/d/...">
            <small style="display:block; margin-top:0.5rem; opacity:0.8;">
                File ‚Üí Share ‚Üí Publish to web ‚Üí CSV ‚Üí Copy link
            </small>
        </div>

        <div class="input-group">
            <label>OR Upload CSV File</label>
            <input type="file" id="csvFile" accept=".csv">
        </div>

        <div class="input-group">
            <label>OR Paste CSV Data</label>
            <textarea id="csvData" rows="4"
                style="width:100%; padding:0.75rem; border-radius:8px; border:2px solid rgba(255,255,255,0.3); font-family:monospace; font-size:0.9rem; box-sizing:border-box;"></textarea>
            <small style="display:block; margin-top:0.5rem; opacity:0.8;">
                Format: Plate,Date,Title (one per line)
            </small>
        </div>

        <div class="button-group">
            <button id="generateBtn">üîÑ Generate Platebook</button>
            <button id="printBtn" disabled>üñ®Ô∏è Print to PDF</button>
        </div>

        <div class="status" id="status"></div>
    </div>

    <!-- Platebook Content (Print Only) -->
    <div id="platebook"></div>

    <script>
        const generateBtn = document.getElementById('generateBtn');
        const printBtn = document.getElementById('printBtn');
        const status = document.getElementById('status');
        const platebookDiv = document.getElementById('platebook');

        generateBtn.addEventListener('click', generatePlatebook);
        printBtn.addEventListener('click', () => window.print());

        async function generatePlatebook() {
            const courseName = document.getElementById('courseName').value;
            const termName = document.getElementById('termName').value;
            const sheetUrl = document.getElementById('sheetUrl').value;
            const csvFile = document.getElementById('csvFile').files[0];
            const csvData = document.getElementById('csvData').value;

            let csvText = '';

            try {
                // Method 1: Google Sheet URL with CORS proxy
                if (sheetUrl) {
                    showStatus('Loading from Google Sheets...', 'success');
                    const proxyUrl = 'https://api.allorigins.win/raw?url=' + encodeURIComponent(sheetUrl);
                    const response = await fetch(proxyUrl);
                    if (!response.ok) throw new Error('Failed to fetch sheet');
                    csvText = await response.text();
                }
                // Method 2: Local file upload
                else if (csvFile) {
                    showStatus('Reading uploaded file...', 'success');
                    csvText = await csvFile.text();
                }
                // Method 3: Pasted CSV data
                else if (csvData) {
                    showStatus('Processing pasted data...', 'success');
                    csvText = csvData;
                }
                else {
                    showStatus('Please provide data via Google Sheet URL, file upload, or paste CSV', 'error');
                    return;
                }

                const lessons = parseCSV(csvText);

                if (lessons.length === 0) {
                    showStatus('No lessons found. Check your CSV format.', 'error');
                    return;
                }

                renderPlatebook(courseName, termName, lessons);
                showStatus(`‚úì Generated ${lessons.length} plates successfully!`, 'success');
                printBtn.disabled = false;

            } catch (error) {
                showStatus('Error: ' + error.message, 'error');
                console.error(error);
            }
        }

        function parseCSV(csv) {
            const lines = csv.trim().split('\n');
            const lessons = [];

            // Skip header row
            for (let i = 1; i < lines.length; i++) {
                const line = lines[i].trim();
                if (!line) continue;

                // Simple CSV parsing (handles basic cases)
                const parts = line.split(',');
                if (parts.length >= 3) {
                    lessons.push({
                        plate_number: parseInt(parts[0]),
                        date: parts[1].replace(/"/g, ''),
                        title: parts[2].replace(/"/g, '')
                    });
                }
            }

            return lessons;
        }

        function renderPlatebook(courseName, termName, lessons) {
            let html = '';

            // Cover Page
            html += `
                <div class="cover-page">
                    <h1>${courseName}</h1>
                    <h2>${termName}</h2>
                    <input type="text" placeholder="Name: _____________________________________">
                </div>
            `;

            // Table of Contents
            html += '<div class="toc-page"><h2>Table of Contents</h2>';
            lessons.forEach(lesson => {
                html += `
                    <div class="toc-entry">
                        <div class="toc-plate">Plate ${lesson.plate_number}</div>
                        <div class="toc-title">${lesson.title}</div>
                        <div class="toc-date">${lesson.date}</div>
                    </div>
                `;
            });
            html += '</div>';

            // Plates
            lessons.forEach(lesson => {
                html += renderPlate(lesson);
            });

            platebookDiv.innerHTML = html;
        }

        function renderPlate(lesson) {
            let html = '<div class="plate">';

            // Header
            html += `<div class="plate-box plate-num"><div class="plate-label">Plate # ${lesson.plate_number}</div></div>`;
            html += `<div class="plate-box plate-title"><div class="plate-label">${lesson.title}</div></div>`;
            html += `<div class="plate-box plate-date"><div class="plate-label">${lesson.date}</div></div>`;

            // PPT Labels
            html += '<div class="plate-box label-person"><div class="plate-label">Person</div></div>';
            html += '<div class="plate-box label-place"><div class="plate-label">Place</div></div>';
            html += '<div class="plate-box label-thing"><div class="plate-label">Thing</div></div>';

            // PPT Grid (3x3)
            for (let row = 0; row < 3; row++) {
                for (let col = 0; col < 3; col++) {
                    html += `<div class="plate-box ppt-box ppt-${row}-${col} filled"></div>`;
                }
            }

            // Timeline
            html += '<div class="plate-box label-timeline"><div class="plate-label">Timeline</div></div>';
            html += '<div class="plate-box box-timeline filled"></div>';
            html += '<div class="timeline-line"></div>';
            for (let i = 0; i <= 10; i++) {
                const left = 50 + (i * 512 / 10);
                html += `<div class="timeline-tick" style="left: ${left}pt;"></div>`;
            }

            // Map
            html += '<div class="plate-box label-map"><div class="plate-label">Map</div></div>';
            html += '<div class="plate-box box-map filled"></div>';

            // Questions
            html += '<div class="plate-box label-pq"><div class="plate-label">Penetrating Questions</div></div>';
            html += '<div class="plate-box label-vsa"><div class="plate-label">Very short answers</div></div>';
            html += '<div class="plate-box q-num-1"><div class="plate-label">1</div></div>';
            html += '<div class="plate-box q-content-1 filled"></div>';
            html += '<div class="plate-box q-answer-1 filled"></div>';
            html += '<div class="plate-box q-num-2"><div class="plate-label">2</div></div>';
            html += '<div class="plate-box q-content-2 filled"></div>';
            html += '<div class="plate-box q-answer-2 filled"></div>';

            // Bottom
            html += '<div class="plate-box label-cec"><div class="plate-label">Causes / Effects / Connections</div></div>';
            html += '<div class="plate-box label-notes"><div class="plate-label">Notes</div></div>';
            html += '<div class="plate-box box-cec filled"></div>';
            html += '<div class="plate-box box-notes filled"></div>';

            html += '</div>';
            return html;
        }

        function showStatus(message, type) {
            status.textContent = message;
            status.className = 'status show ' + type;
        }
    </script>
</body>

</html>